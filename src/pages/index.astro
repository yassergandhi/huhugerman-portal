---
import Layout from '../layouts/Layout.astro';
---
<Layout title="Inicio">
  <div class="container">
    <h1 style="text-align:center; margin-bottom: 2rem;">W칛hle deinen Kurs (Elige tu nivel)</h1>
    
    <div class="grid">
      <div class="card">
        <span class="status-badge">A1.1</span>
        <h2>游뾇릖 Alem치n 1</h2>
        <p>Estructuras b치sicas, verbos en presente y vocabulario de supervivencia.</p>
        <button class="btn js-course-btn" data-url="/aleman1">Ir al Curso</button>
      </div>

      <div class="card">
        <span class="status-badge">A1.2</span>
        <h2>游뾇릖 Alem치n 2</h2>
        <p>Hablar sobre tus pasatiempos y la vida cotidiana.</p>
        <button class="btn js-course-btn" data-url="/aleman2">Ir al Curso</button>
      </div>
    </div>
  </div>

  <script>
    import { supabase } from '../lib/supabase';
    
    // Interceptamos los clicks para asegurar que est칠n logueados
    const buttons = document.querySelectorAll('.js-course-btn');
    
    buttons.forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const url = e.target.getAttribute('data-url');
        const { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
          // Si no hay sesi칩n, loguear primero y redirigir al curso
          await supabase.auth.signInWithOAuth({
            provider: 'google',
            options: { redirectTo: window.location.origin + url }
          });
        } else {
          window.location.href = url;
        }
      });
    });
  </script>
</Layout>
